extends layout

block head
  
  script(type='text/javascript').

      document.addEventListener("DOMContentLoaded", function() {
        
        var results = ko.observableArray();
        ko.applyBindings(results, document.getElementById("results"));

        var container = document.getElementById('singlePackage');
        var options = {
              nodes: {
                shape: 'box'
              },
              edges: {
                style: 'arrow',
                color: 'green'
              },
              physics: {
                repulsion: {
                  centralGravity: 0.1,
                  nodeDistance: 200
                }
              }
        };

        var data = {
          nodes: new vis.DataSet(),
          edges: new vis.DataSet(),
        }

        var network = new vis.Network(container, data, options);

        var inputStream = NugetVis.asStream(document.getElementById("search"));
        var loader = new NugetVis.Loader("http://www.nuget.org/api/v2");
        loader
          .searchPackages(inputStream)
          .subscribe(function (packages) {
            results.removeAll();
            results.pushAll(packages);
          });

        $('#search').focus();

      });

block content
  nav(class='navbar navbar-default' role='navigation')
    div(class='container-fluid')
      div(class='navbar-header')
        span(class='navbar-brand') Nuget Deps Visualizer
      ul(class='nav navbar-nav')
        li
          form(class='navbar-form navbar-left')
            div(class='form-group')
              input(id='search', type='text', class='form-control', autocomplete='off')
        li(class='dropdown')
          a(href='#', class='dropdown-toggle' data-toggle='dropdown') Matching Packages
            span(class='caret')
          ul(id='results', class='dropdown-menu', data-bind='foreach: $data')
            li
              a(data-bind='click: loadPackage')
                  span(data-bind='text: Id, attr: {title: Description}')
                  span , Version:
                  span(data-bind='text: Version')

  div(class='container-fluid')
    div(class='row')
      div(class='span12')
        div(id='singlePackage')